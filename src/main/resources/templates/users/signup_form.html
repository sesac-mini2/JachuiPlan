<html layout:decorate="~{layout}">
<th:block layout:fragment="sidebar">
    <nav th:replace="~{users/users_sidebar :: sidebarFragment}"></nav>
</th:block>
<th:block layout:fragment="content">
    <h1>회원가입</h1>
    <form th:action="@{/users/signup}" method="post">
        <!-- 아이디 입력 -->
        <div>
            <label for="username">아이디</label>
            <input type="text" id="username" name="username" required>
            <button type="button" id="check-username">중복 확인</button>
            <span id="username-message"></span>
        </div>

        <!-- 비밀번호 입력 -->
        <div>
            <label for="password">비밀번호</label>
            <input type="password" id="password" name="password" required>
        </div>

        <!-- 비밀번호 확인 -->
        <div>
            <label for="confirmPassword">비밀번호 확인</label>
            <input type="password" id="confirmPassword" name="confirmPassword" required>
            <span id="password-match-message" class="error-message"></span>
        </div>

        <!-- 닉네임 입력 -->
        <div>
            <label for="nickname">닉네임</label>
            <input type="text" id="nickname" name="nickname" required>
            <button type="button" id="check-nickname">중복 확인</button>
            <span id="nickname-message"></span>
        </div>

        <button type="submit">회원가입</button>
    </form>
</th:block>
<th:block layout:fragment="script">
    <!-- JavaScript -->
    <script>
        // 비밀번호 일치 확인
        const password = document.getElementById("password");
        const confirmPassword = document.getElementById("confirmPassword");
        const passwordMatchMessage = document.getElementById("password-match-message");

        confirmPassword.addEventListener("input", function () {
            if (password.value !== confirmPassword.value) {
                passwordMatchMessage.textContent = "비밀번호가 일치하지 않습니다.";
            } else {
                passwordMatchMessage.textContent = "";
            }
        });

        password.addEventListener("input", function () {
            if (password.value !== confirmPassword.value) {
                passwordMatchMessage.textContent = "비밀번호가 일치하지 않습니다.";
            } else {
                passwordMatchMessage.textContent = "";
            }
        });

       // 아이디 중복 확인 AJAX
    document.getElementById("check-username").addEventListener("click", function () {
        const username = document.getElementById("username").value;
        const usernameMessage = document.getElementById("username-message");

        if (!username) {
            alert("아이디를 입력해주세요.");
            return;
        }

        fetch(`/users/check-username?username=${username}`)
            .then(response => {
                if (response.ok) {
                    return response.text(); // 서버에서 반환된 메시지 (사용 가능한 아이디)
                } else {
                    throw new Error("이미 있는 아이디입니다."); // 서버에서 400 응답
                }
            })
            .then(data => {
                // 성공: 사용 가능한 아이디
                usernameMessage.textContent = data; // 서버 메시지 출력
                usernameMessage.className = "success-message"; // 초록색으로 표시
            })
            .catch(error => {
                // 실패: 이미 있는 아이디
                usernameMessage.textContent = error.message;
                usernameMessage.className = "error-message"; // 빨간색으로 표시
            });
    });

    // 닉네임 중복 확인 AJAX
    document.getElementById("check-nickname").addEventListener("click", function () {
        const nickname = document.getElementById("nickname").value;
        const nicknameMessage = document.getElementById("nickname-message");

        if (!nickname) {
            alert("닉네임을 입력해주세요.");
            return;
        }

        fetch(`/users/check-nickname?nickname=${nickname}`)
            .then(response => {
                if (response.ok) {
                    return response.text(); // 서버에서 반환된 메시지 (사용 가능한 닉네임)
                } else {
                    throw new Error("이미 있는 닉네임입니다."); // 서버에서 400 응답
                }
            })
            .then(data => {
                // 성공: 사용 가능한 닉네임
                nicknameMessage.textContent = data; // 서버 메시지 출력
                nicknameMessage.className = "success-message"; // 초록색으로 표시
            })
            .catch(error => {
                // 실패: 이미 있는 닉네임
                nicknameMessage.textContent = error.message;
                nicknameMessage.className = "error-message"; // 빨간색으로 표시
            });
    });

    </script>
</th:block>
</html>
